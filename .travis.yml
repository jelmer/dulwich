language: python
sudo: false
os:
  - linux
  - osx
python:
  - "2.7"
  - "pypy"
  - "pypy3"
  - "3.4"
  - "3.5"
  - "3.5-dev"
  - "3.6"
  - "3.6-dev"
  - "3.7-dev"
cache:
  directories:
    - $HOME/.cache/pip
install:
  - pip install pip --upgrade
  - pip install fastimport
  - test "$TRAVIS_PYTHON_VERSION" = "pypy" || pip install gevent greenlet geventhttpclient
script:
  # Test without c extensions
  - PYTHONHASHSEED=random python -m unittest dulwich.tests.test_suite

  # Test with c extensions
  - python setup.py build_ext -i
  - PYTHONHASHSEED=random python -m unittest dulwich.tests.test_suite

